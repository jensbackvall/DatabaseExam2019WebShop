<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Shopping Basket</title>
    <script src="https://code.jquery.com/jquery-3.3.1.js" type="text/javascript"></script>
    <script src="../shopping-basket/shoppingbasket.js"></script>
    <link rel="stylesheet" type="text/css" href="../shopping-basket/shoppingbasket.css" />
    <link rel="stylesheet" type="text/css" href="../main.css" />
</head>
<body>
    <header>
        <div class="logo">
            <a href="/">
                <img src="../images/logo.png" alt="logo">
            </a>
        </div>
        <div class="mid-header"></div>
        <div class="loginregister">
            <button class="gotologinbutton" onclick="window.location.href = '../login/login.html';">LOG IN</button>
            <button class="gotoregisterbutton" onclick="window.location.href = '../register/register.html';">REGISTER NEW USER</button>
            <br><br><br>
            <a class="cart" href="../shopping-basket/shoppingbasket.html"><img src="../images/cart.png" alt="cart"></a>
        </div>
    </header>
    <main>
        <div class="basket">
            <div class="productNameColumn">
                Product<br><br>
            </div>
            <div class="productPriceColumn">
                Price<br><br>
            </div>
            <div class="productQuantityColumn">
                Quantity<br><br>
            </div>
            <div class="productTotalPriceColumn">
                Total Price<br><br>
            </div>

        </div>
        <div class="purchasing-line">
            <button class="purchasing-button">Checkout & Pay</button>
        </div>
    </main>
    <footer></footer>
</body>
<script>
    if (window.localStorage.getItem('username') != null) {
        $(".mid-header").html("Logged in as: " + window.localStorage.getItem('username') + "<br><br><button type='submit'  id='logOutButton'>Log Out</button>");    
    }

    $(`#logOutButton`).click((event) => {
        window.localStorage.removeItem("username");
        window.localStorage.removeItem("userid");
        $(".mid-header").remove(`#logOutButton`);
        location.reload(true);
    });

    const productsInCart = JSON.parse(window.localStorage.getItem('productsInCart'));
    console.log('PRODUCTS IN CART: ', productsInCart);
    let numberOfProductsInCart = 0;
    for (var key in productsInCart['Name']) {
        if(productsInCart['Name'].hasOwnProperty(key))
        numberOfProductsInCart++;
    };
    console.log(numberOfProductsInCart);
    let productsIdArray = Object.keys(productsInCart['Name']);
    console.log(productsIdArray);
    let totalPrice = 0;

    for (let i = 0; i < numberOfProductsInCart; i++) {
        
        const productColumn_html = "<div>" + productsInCart['Name'][productsIdArray[i]].substring(0,15) + "</div>";

        const priceColumn_html = "<div>DKK " + productsInCart['Price'][productsIdArray[i]] + "</div>";

        const quantityColumn_html = "<div>" + productsInCart['Quantity'][productsIdArray[i]] + "</div>";

        const totalPriceForProduct = (productsInCart['Price'][productsIdArray[i]] * productsInCart['Quantity'][productsIdArray[i]]);

        const totalPriceColumn_html = "<div>DKK " + totalPriceForProduct + "</div>";

        totalPrice = totalPrice + totalPriceForProduct;

        $(".productNameColumn").append(productColumn_html);
        $(".productPriceColumn").append(priceColumn_html);
        $(".productQuantityColumn").append(quantityColumn_html);
        $(".productTotalPriceColumn").append(totalPriceColumn_html);
        
        if (i === numberOfProductsInCart - 1) {
            $(".productQuantityColumn").append("<br>TOTAL:");
            $(".productTotalPriceColumn").append("<br>DKK " + totalPrice.toFixed(2));
            $(".productQuantityColumn").append("<br><br>VAT:");
            $(".productTotalPriceColumn").append("<br><br>DKK " + (totalPrice * 0.25).toFixed(2));
            $(".productQuantityColumn").append("<br><br>PRICE + VAT:");
            const totalPriceInclVAT = totalPrice + (totalPrice * 0.25);
            $(".productTotalPriceColumn").append("<br><br>DKK " + totalPriceInclVAT.toFixed(2));
        }
    }




</script>
</html>